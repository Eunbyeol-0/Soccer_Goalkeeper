<root BTCPP_format="4">
    <!-- 포함될 BT 파일들 -->
    <!--<include path="./dribble.xml" />-->
    <include path="./subtrees/locate.xml" />
    <include path="./subtrees/cam_find_and_track_ball.xml" />
    <include path="./subtrees/goalkeeper.xml" />

    <!-- 시작 -->
    <BehaviorTree ID="MainTree">
        <Sequence name="root">
            <RunOnce><Script code="control_state=1" /></RunOnce>

            <ReactiveSequence _while="control_state==1">

                <ReactiveSequence _while="gc_is_under_penalty" name="Penalty">
                    <SetVelocity x="0.0" y="0.0" theta="0.0" />
                    <SelfLocateEnterField />
                </ReactiveSequence>

                <ReactiveSequence _while="!gc_is_under_penalty" name="No_Penalty">
                    
                    <ReactiveSequence _while="gc_game_sub_state_type=='TIMEOUT'" name="Timeout">
                        <SetVelocity x="0.0" y="0.0" theta="0.0" />
                        <SelfLocateEnterField />
                    </ReactiveSequence>

                    <ReactiveSequence _while="gc_game_sub_state_type=='NONE'" name="Normal_Game">
                        
                        <ReactiveSequence _while="gc_game_state=='INITIAL'" name="Initial">
                            <CamScanField _while="!odom_calibrated"/>
                            <SubTree ID="CamFindAndTrackBall" _while="odom_calibrated" _autoremap="true" />
                            <SelfLocateEnterField /> 
                        </ReactiveSequence>

                        <ReactiveSequence _while="gc_game_state=='READY'" name="Ready">
                            <SubTree ID="CamFindAndTrackBall" _autoremap="true" /> 
                            <GolieInitPos vx_limit="0.3" vy_limit="0.15"/>
                            <SubTree ID="Locate" _autoremap="true" />
                        </ReactiveSequence>

                        <ReactiveSequence _while="gc_game_state=='SET'" name="Set">
                            <!--<SetVelocity x="0.0" y="0.0" theta="0.0" />-->
                            <SubTree ID="CamFindAndTrackBall" _autoremap="true" /> 
                            <SubTree ID="Locate" _autoremap="true" />
                            <!--검증용-->
                            <ReactiveSequence>
                                 <GoalieClearingDecide decision_out="{clearing_decision}" decision_in="{clearing_decision}" />
                            </ReactiveSequence>
                            <ReactiveSequence _while="clearing_decision == 'clearing_chase'">
                                <CalcClearingDir/>
                                <ClearingChase vx_limit="1.0" vy_limit="0.1" vtheta_limit="1.0" dist="0.2" safeDist="0.5" />
                            </ReactiveSequence>
                            <Kick _while="clearing_decision == 'clearing_kick'" speed_limit="1.0" min_msec_kick="300" msecs_stablize="100" kick_type="one_touch" />
                        </ReactiveSequence>

                        <ReactiveSequence _while="gc_game_state=='PLAY'" name="Play">
                            <SubTree ID="CamFindAndTrackBall" _autoremap="true" />

                            <ReactiveSequence>
                                <SubTree ID="Goalkeeper" _autoremap="true" _while="player_role == 'goal_keeper'" />
                            </ReactiveSequence>
                            <SubTree ID="Locate" _autoremap="true" />
                        </ReactiveSequence>

                        <ReactiveSequence _while="gc_game_state=='END'" name="End">
                            <SetVelocity x="0.0" y="0.0" theta="0.0" />
                        </ReactiveSequence>

                    </ReactiveSequence>
                    <ReactiveSequence _while="gc_game_sub_state_type=='FREE_KICK' && gc_game_state=='PLAY'" name="Free_Kick">
                         <SetVelocity x="0.0" y="0.0" theta="0.0" />
                         <SubTree ID="Locate" _autoremap="true" />
                    </ReactiveSequence>

                    <ReactiveSequence _while="gc_game_sub_state=='GET_READY'">
                        <SubTree ID="Locate" _autoremap="true" _while="ball_location_known" />
                    </ReactiveSequence>

                    <ReactiveSequence _while="gc_game_sub_state=='SET'">
                        <SubTree ID="CamFindAndTrackBall" _autoremap="true" />
                        <SubTree ID="Locate" _autoremap="true" _while="ball_location_known" />
                        <SetVelocity />
                    </ReactiveSequence>

                </ReactiveSequence>
            </ReactiveSequence>
        </Sequence>
    </BehaviorTree>
</root>
